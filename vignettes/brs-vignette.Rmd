---
title: "brs: Bayesian Rule Set"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{brs-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

**R** package for *Bayesian Rule Set: A Quantitative Alternative to Qualitative Comparative Analysis.*

**References**: 
 
 - Chiu, Albert and Yiqing Xu. "Bayesian Rule Set: A Quantitative Alternative to Qualitative Comparative Analysis." *The Journal of Politics* 85, no. 1 (2023):. 
 - Wang, Tong, Cynthia Rudin, Finale Doshi-Velez, Yimin Liu, Erica Klampfl, and Perry MacNeille. "A bayesian framework for learning rule sets for interpretable classification." *The Journal of Machine Learning Research* 18, no. 1 (2017): 2357-2393.
 
**R** source files can be found on [GitHub](https://github.com/albert-chiu/brs). **R** code used in this demonstration can also be downloaded from [GitHub](https://github.com/albert-chiu/brs/tree/main/vignettes).


```{r setup, cache=T}
# First create conda environment 
# do this *before* loading the brs package. If you've already loaded brs, you 
#     may need to restart R and rerun the code in the order shown below
# Note: this code is for computers with Apple silicon (M1, etc.)

# install python and packages to environment
#reticulate::conda_create(envname = "BRS_conda")
reticulate::conda_install(envname = "BRS_conda3",
  conda="~/miniforge3/condabin/conda",  # path to conda binary
  packages = c("numpy", "pandas", "scikit-learn", "scipy"))
reticulate::use_condaenv(condaenv="BRS_conda3")  ## use this conda environment for BRS

# load brs
library(brs)
```

```{r brs, cache=T}
set.seed(123)
# load data for example
data("lipset_df", "lipset_Y")  

# run BRS with default parameters
out_lipset <- brs::BRS(df = lipset_df, Y = lipset_Y, seed = 123, 
                       maxLen=3L, bootstrap = T, reps=100L)
```

```{r barplot}
# barplot
fdf <- cbind(colnames(lipset_df),
             c("Wealth (high)", "Wealth (med)", "Wealth (low)",
               "Urbanization (high)", "Urbanization (low)", 
               "Education (high)", "Education (low)", 
               "Industrialization (high)", "Industrialization (low)"))
oppmat <- matrix(c(0,1), ncol=2)
oppind <- list(unique(unlist(lapply(colnames(lipset_df), function(x) strsplit(x, "_")[[1]][[1]])))[2:4])

lipset_bar <- brs::plot_bar(df = lipset_df, Y=lipset_Y, fit = out_lipset, featureLabels = fdf,
              maxLen=3, minProp = .05, topRules=5, 
                           simplify = T, oppmat=oppmat, oppind=oppind, and =" & ",
                           plotBuffer = c(.25, 0, .4), boot_rep = 100L,
                           titleSize=10, rule_text_size = 10, number_size = 10)
```

```{r print-barplot, fig.dim = c(7, 4)}
print(lipset_bar)
```
